#lang pollen

◊(define-meta title "All Posts")
◊(define-meta author "Faiz Surani")

◊p{Going back to the dawn of time.}

◊(define (list-posts-in-series s #:doc-publish-date [doc-publish-date #t])
    (define (make-li post)
        (if doc-publish-date
            `(li (a [[href ,(symbol->string post)]]
                    (span [[class "smallcaps"]] ,(select-from-metas 'title post))) " - " ,(pubdate->abbr-english (select-from-metas 'doc-publish-date post)))
            `(li (a [[href ,(symbol->string post)]]
                    (span [[class "smallcaps"]] ,(select-from-metas 'title post))))))

    (define (is-child-post? p)
        (equal? s (string->symbol (select-from-metas 'series p))))

    `(section (h2 ,(select-from-metas 'title s))
                (ul ,@(map make-li (filter is-child-post? (children 'posts.html))))))

◊;    For every child of series.html in the pagetree, we list that page’s
◊; title and summary, then we list all the children of posts.html that
◊; specify that series in their meta definitions.

◊; ◊(->html (list-posts-in-series 'series/notebook.html #:author #f))

◊(->html (list-posts-in-series 'series/poems.html))

◊(->html (list-posts-in-series 'series/law.html))
